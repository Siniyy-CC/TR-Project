<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>《愛的藝術》影展入場券生成</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           核心配色与纹理定义
        ========================================= */
        :root {
            /* --- 默认观众主题 (米白紅) --- */
            --theme-bg-color: #fdfbf7;
            --theme-bg-texture: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAD2Cz0MAAAADFBMVEUAAAD////8/Pz///+///+/AAAAAnRSTlP/AOW3MEoAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnSURBVEiJ7dExAQAAAMKg9U9tCy+gAAAAAAAAAAAAAAAAAAAAvABzaAABFDm3GgAAAABJRU5ErkJggg==');
            --theme-bg-blend: multiply;
            --theme-header-bg: #8E3535;
            --theme-header-texture: none; 
            --theme-text-main: #1a1a1a;
            --theme-text-sub: #666;
            --theme-accent: #8E3535;
            --theme-border: #ccc;
            --theme-shadow: rgba(0,0,0,0.6);
            --theme-barcode-opacity: 0.6;
        }

        /* --- 导演主题 (黑金) --- */
        [data-theme="director"] {
            --theme-bg-color: #1a1a1a;
            --theme-bg-texture: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyAQMAAAAk8RryAAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlP/AOW3MEoAAAARElEQVQY02NggAJfMJRcQAAA4YAhAW6CCwAAAABJRU5ErkJggg==');
            --theme-header-bg: #000; 
            --theme-header-texture: repeating-linear-gradient(135deg, #b88a00, #b88a00 2px, #d4af37 2px, #d4af37 4px);
            --theme-text-main: #d4af37;
            --theme-text-sub: #967c3a;
            --theme-accent: #d4af37;
            --theme-border: #5c4d26;
            --theme-shadow: rgba(212, 175, 55, 0.3);
            --theme-barcode-opacity: 0.8;
        }

        /* --- 恋人主题 (复古粉) --- */
        [data-theme="lover"] {
            --theme-bg-color: #faf0e6;
            --theme-bg-texture: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAANlBMVEX////////////////////////////////////////////////////////////////////EtsMVAAAAEnRSTlP/AK0wEc8qIb5g00Q4t8d0sV588G8AAAEtSURBVFjD7dbbcoIwEAbgQ0sFEXGoVavW+v6v2okSpQ2EkM2c+b8H5k+yIWEP/4g6T/d7/Q559vW6m4D5dDqawOVwOIyA8/5wGIHlYf/Zgs3D7s9g/bBbgaVhvXgD1uL1YgRGi9WfweJi9QIsFqsfQGu+eAG25ouXN6A7XzwBnfniBWiL588X0BfPny9gK54/X8BOPG+/gK143n4Be/G8/QKu4m/gK96238BavG2/ga14234De/G2/QG+4m37A/zF2/YHjMVz+wOG4rm9AdfiuT0C1+K5PQL34rk9AorifXsETMW/wEw8t0fAXLxsj4CFCJ0Q9iJ0QjhI8AmRCRERQidEhIidEDkidh80IWInxIIInRALInRCLIfQCRERInZCRITQCRERInZCxI64iV+Ify9+AOo+91z37k7VAAAAAElFTkSuQmCC');
            --theme-header-bg: #c48b9f;
            --theme-header-texture: repeating-linear-gradient(135deg, rgba(184, 138, 0, 0.3), rgba(184, 138, 0, 0.3) 2px, rgba(212, 175, 55, 0.3) 2px, rgba(212, 175, 55, 0.3) 4px);
            --theme-text-main: #7D3C4C;
            --theme-text-sub: #a67b85;
            --theme-accent: #7D3C4C;
            --theme-border: #dcaab6;
            --theme-shadow: rgba(196, 139, 159, 0.4);
            --theme-barcode-opacity: 0.7;
        }

        /* =========================================
           基础样式
        ========================================= */
        body {
            background-color: #0a0a0a;
            color: #eee;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: background-color 0.5s ease;
        }
        
        body.director-active { background-color: #000; }
        body.lover-active { background-color: #1a0f11; }

        h2, button, .controls p { font-family: 'Cinzel', serif; }
        h2 { margin-bottom: 10px; font-weight: 400; letter-spacing: 2px; }

        .controls {
            margin-bottom: 40px;
            text-align: center;
            width: 100%;
            max-width: 400px;
        }

        input {
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #333;
            background-color: #222;
            color: #8E3535;
            width: 70%;
            margin-bottom: 15px;
            font-size: 16px;
            text-align: center;
            font-family: 'Noto Serif TC', serif;
            outline: none;
            transition: all 0.3s;
        }
        input:focus { border-color: #8E3535; box-shadow: 0 0 10px rgba(142, 53, 53, 0.4); }
        
        body.director-active input { color: #d4af37; }
        body.director-active input:focus { border-color: #d4af37; box-shadow: 0 0 10px rgba(212, 175, 55, 0.4); }
        body.lover-active input { color: #c48b9f; }
        body.lover-active input:focus { border-color: #c48b9f; box-shadow: 0 0 10px rgba(196, 139, 159, 0.4); }

        button {
            padding: 10px 30px;
            background: linear-gradient(45deg, #8E3535, #a64444);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 14px;
            cursor: pointer;
            letter-spacing: 1px;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(142, 53, 53, 0.4);
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(142, 53, 53, 0.6); }
        
        body.director-active button { background: linear-gradient(45deg, #d4af37, #f2d06b); color: #000; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4); }
        body.lover-active button { background: linear-gradient(45deg, #c48b9f, #dcaab6); color: #fff; box-shadow: 0 4px 15px rgba(196, 139, 159, 0.4); }

        /* =========================================
           票根样式
        ========================================= */
        #ticket-container {
            width: 320px; 
            background-color: var(--theme-bg-color);
            background-image: var(--theme-bg-texture);
            background-blend-mode: var(--theme-bg-blend);
            color: var(--theme-text-main);
            border-radius: 8px;
            box-shadow: 0 20px 40px var(--theme-shadow);
            overflow: hidden;
            position: relative;
            transition: all 0.6s;
        }

        .ticket-header {
            background-color: var(--theme-header-bg);
            background-image: var(--theme-header-texture);
            height: 20px; 
            width: 100%;
            transition: all 0.6s;
        }

        .ticket-body {
            padding: 30px 25px 15px 25px;
            text-align: center;
            border-bottom: 2px dashed var(--theme-border);
            position: relative;
            transition: border-color 0.6s;
        }
        .ticket-body::before, .ticket-body::after {
            content: ''; position: absolute; bottom: -10px; width: 20px; height: 20px;
            background-color: #0a0a0a; border-radius: 50%; transition: background-color 0.5s ease;
        }
        .ticket-body::before { left: -10px; }
        .ticket-body::after { right: -10px; }
        body.director-active .ticket-body::before, body.director-active .ticket-body::after { background-color: #000; }
        body.lover-active .ticket-body::before, body.lover-active .ticket-body::after { background-color: #1a0f11; }

        .film-title { font-family: 'Noto Serif TC', serif; font-size: 28px; font-weight: 700; margin: 5px 0 10px 0; letter-spacing: 3px; color: var(--theme-text-main); transition: color 0.6s; }
        .film-subtitle { font-family: 'Cinzel', serif; font-size: 14px; color: var(--theme-text-sub); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 5px; font-weight: 700; transition: color 0.6s; }
        .starring { font-family: 'Cinzel', serif; font-size: 10px; color: var(--theme-text-sub); margin-bottom: 15px; letter-spacing: 1px; transition: color 0.6s; }
        .project-note { font-family: 'Noto Serif TC', serif; font-size: 10px; color: var(--theme-accent); letter-spacing: 1px; margin-top: 15px; opacity: 0.8; transition: color 0.6s; }

        .secret-message {
            height: 0; overflow: hidden; opacity: 0; font-size: 11px; color: var(--theme-accent);
            font-family: 'Noto Serif TC', serif; margin-top: 0; letter-spacing: 2px; font-weight: bold;
            transition: all 0.6s; border-top: 1px solid transparent;
        }
        [data-theme="director"] .secret-message, [data-theme="lover"] .secret-message {
            height: auto; opacity: 1; margin-top: 10px; padding-top: 10px; border-color: var(--theme-border);
        }

        .info-grid { display: flex; justify-content: space-between; font-family: 'Cinzel', serif; font-size: 10px; color: var(--theme-text-sub); margin-top: 20px; text-align: left; transition: color 0.6s; }
        .info-item span { display: block; font-weight: 700; color: var(--theme-text-main); font-size: 14px; margin-top: 2px; font-family: 'Helvetica Neue', sans-serif; transition: color 0.6s; }

        .ticket-stub { padding: 15px 25px; background-color: var(--theme-bg-color); background-image: var(--theme-bg-texture); background-blend-mode: var(--theme-bg-blend); display: flex; justify-content: space-between; align-items: center; transition: all 0.6s; }
        .guest-name { font-family: "Courier New", Courier, monospace; font-size: 16px; font-weight: bold; color: var(--theme-accent); text-transform: uppercase; max-width: 180px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; transition: color 0.6s; }
        .admit-one { font-family: 'Cinzel', serif; font-size: 9px; color: var(--theme-text-sub); letter-spacing: 1px; border: 1px solid var(--theme-text-sub); padding: 3px 6px; transition: all 0.6s; }
        [data-theme="director"] .admit-one, [data-theme="lover"] .admit-one { color: var(--theme-accent); border-color: var(--theme-accent); font-weight: bold; }
        
        .barcode { height: 25px; width: 100%; background: linear-gradient(to right, currentColor 0%, currentColor 3%, transparent 3%, transparent 5%, currentColor 5%, currentColor 8%, transparent 8%, transparent 10%, currentColor 10%, currentColor 15%, transparent 15%, transparent 18%, currentColor 18%, currentColor 25%, transparent 25%, transparent 30%, currentColor 30%, currentColor 45%, transparent 45%, transparent 50%, currentColor 50%, currentColor 55%, transparent 55%, transparent 60%, currentColor 60%, currentColor 70%, transparent 70%, transparent 80%, currentColor 80%, currentColor 100%); margin-top: 15px; opacity: var(--theme-barcode-opacity); color: var(--theme-text-sub); transition: color 0.6s, opacity 0.6s; }
        .footer-note { margin-top: 20px; font-size: 12px; color: #666; font-family: 'Cinzel', serif; }
        .closing-statement { text-align: center; margin: 50px 20px; color: #888; font-family: 'Noto Serif TC', serif; font-size: 12px; line-height: 2; opacity: 0.8; }

        /* =========================================
           【新增】长按保存弹窗样式
        ========================================= */
        #result-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: none; /* 默认隐藏 */
            flex-direction: column; align-items: center; justify-content: center;
        }
        #result-modal img {
            max-width: 90%; max-height: 80vh;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }
        .modal-tip {
            color: #d4af37; font-family: 'Noto Serif TC', serif; margin-top: 20px; font-size: 14px; letter-spacing: 2px;
            animation: pulse 2s infinite;
        }
        .modal-close {
            position: absolute; top: 20px; right: 20px;
            color: #fff; font-size: 30px; cursor: pointer;
            font-family: Arial, sans-serif;
        }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

    </style>
</head>
<body id="main-body">

    <div class="controls">
        <h2>ARS AMATORIA</h2>
        <p style="font-size: 12px; color: #999; margin-bottom: 15px;">Please enter your name to retrieve ticket</p>
        <input type="text" id="nameInput" placeholder="..." maxlength="25">
        <br>
        <button onclick="generateAndShow()" id="dl-btn">GET TICKET</button>
    </div>

    <div id="ticket-container" data-theme="default">
        <div class="ticket-header"></div>
        <div class="ticket-body">
            <div class="film-subtitle">Ars Amatoria</div>
            <div class="film-title">《愛的藝術》</div>
            <div class="starring">STARRING: NoFear × QingRong</div>
            <div class="barcode"></div>
            <div class="info-grid">
                <div class="info-item">DATE<span id="ticket-date">DEC 24</span></div>
                <div class="info-item">TIME<span id="ticket-time">18:00</span></div>
                <div class="info-item">SEAT<span id="seat-type">VIP</span></div>
            </div>
            <div class="project-note">桃絨2025聖誕企劃</div>
            <div class="secret-message" id="secret-msg-text">— 感謝您構建了這個世界 —</div>
        </div>
        <div class="ticket-stub">
            <div>
                <div style="font-size: 9px; color: var(--theme-text-sub); font-family:'Cinzel',serif; transition: color 0.6s;" id="role-label">GUEST</div>
                <div class="guest-name" id="display-name">AUDIENCE</div>
            </div>
            <div class="admit-one">ADMIT ONE</div>
        </div>
    </div>

    <div class="closing-statement">
        <p>—— 帷幕落下 ——</p>
        <p>感謝蒞臨《Ars Amatoria》特別展映。</p>
        <p>請收好您的入場券，它是通往回憶的唯一憑證。</p>
        <p style="margin-top: 20px; font-family: 'Cinzel', serif; letter-spacing: 2px;">FIN.</p>
    </div>
    <div class="footer-note">Created for NoFear × QingRong</div>

    <div id="result-modal">
        <div class="modal-close" onclick="closeModal()">×</div>
        <img id="result-img" src="" alt="Ticket">
        <div class="modal-tip">請長按圖片保存至相冊</div>
    </div>

    <script>
        const directorsSchedule = {
            "1cho": { date: "DEC 24", time: "18:00" },
            "如果要让我来讲这个故事": { date: "DEC 24", time: "20:00" },
            "祚": { date: "DEC 24", time: "22:00" },
            "這壹片珎珠海": { date: "DEC 24", time: "24:00" },
            "雪梨": { date: "DEC 25", time: "08:00" },
            "palpitate_51": { date: "DEC 25", time: "10:00" },
            "debrisoo": { date: "DEC 25", time: "12:00" },
            "蔓越莓脆曲奇": { date: "DEC 25", time: "14:00" },
            "过世路粉": { date: "DEC 25", time: "16:00" },
            "aristolight": { date: "DEC 25", time: "18:00" }
        };
        const loversList = ["yyyyq", "apricot", "denny", "nofear", "qingrong", "杨涛", "黄垚钦", "清融", "无畏"];

        const nameInput = document.getElementById('nameInput');
        const displayName = document.getElementById('display-name');
        const ticketContainer = document.getElementById('ticket-container');
        const roleLabel = document.getElementById('role-label');
        const seatType = document.getElementById('seat-type');
        const mainBody = document.getElementById('main-body');
        const dateEl = document.getElementById('ticket-date');
        const timeEl = document.getElementById('ticket-time');
        const secretMsgText = document.getElementById('secret-msg-text');
        
        // 弹窗相关元素
        const modal = document.getElementById('result-modal');
        const resultImg = document.getElementById('result-img');

        nameInput.addEventListener('input', function() {
            const inputVal = this.value.trim();
            const inputKey = inputVal.toLowerCase();
            
            if (inputVal === "") { displayName.innerText = "AUDIENCE"; } 
            else { displayName.innerText = inputVal; }

            if (directorsSchedule[inputKey]) {
                setTheme('director');
                roleLabel.innerText = "DIRECTOR"; seatType.innerText = "CREW";
                secretMsgText.innerText = "— 感謝您構建了這個世界 —";
                dateEl.innerText = directorsSchedule[inputKey].date;
                timeEl.innerText = directorsSchedule[inputKey].time;
            } else if (loversList.includes(inputKey)) {
                setTheme('lover');
                roleLabel.innerText = "LOVER"; seatType.innerText = "VVIP";
                secretMsgText.innerText = "— 愛是永不落幕的電影 —";
                dateEl.innerText = "DEC 24"; timeEl.innerText = "FOREVER";
            } else {
                setTheme('default');
                roleLabel.innerText = "GUEST"; seatType.innerText = "VIP";
                dateEl.innerText = "DEC 24"; timeEl.innerText = "18:00";
            }
        });

        function setTheme(theme) {
            ticketContainer.setAttribute('data-theme', theme);
            mainBody.classList.remove('director-active', 'lover-active');
            if (theme === 'director') { mainBody.classList.add('director-active'); } 
            else if (theme === 'lover') { mainBody.classList.add('lover-active'); }
        }

        // 修改后的生成函数：不下载，直接展示
        function generateAndShow() {
            const ticket = document.getElementById("ticket-container");
            const originalShadow = ticket.style.boxShadow;
            ticket.style.boxShadow = 'none'; // 去掉阴影避免边缘黑边

            html2canvas(ticket, {
                scale: 3, 
                backgroundColor: null, 
                useCORS: true,
                allowTaint: true 
            }).then(canvas => {
                ticket.style.boxShadow = originalShadow; // 恢复阴影
                
                // 将画布转为图片URL
                const imgData = canvas.toDataURL("image/png");
                
                // 显示在弹窗里
                resultImg.src = imgData;
                modal.style.display = 'flex';
                
            }).catch(err => {
                alert("生成失敗，請重試或直接截圖。");
                ticket.style.boxShadow = originalShadow;
            });
        }

        // 关闭弹窗
        function closeModal() {
            modal.style.display = 'none';
        }
    </script>
</body>
</html>
