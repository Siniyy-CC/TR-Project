<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã€Šæ„›çš„è—è¡“ã€‹å½±å±•ç¥¨æ ¹ç”Ÿæˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           æ ¸å¿ƒé…è‰²ä¸çº¹ç†å®šä¹‰
        ========================================= */
        :root {
            /* --- é»˜è®¤è§‚ä¼—ä¸»é¢˜ (ç±³ç™½ç´…) --- */
            --theme-bg-color: #fdfbf7;
            /* é€šç”¨å¤å¤çº¸å¼ çº¹ç† (PNGæ ¼å¼ï¼Œå®‰å…¨ç¨³å®š) */
            --theme-bg-texture: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAD2Cz0MAAAADFBMVEUAAAD////8/Pz///+///+/AAAAAnRSTlP/AOW3MEoAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnSURBVEiJ7dExAQAAAMKg9U9tCy+gAAAAAAAAAAAAAAAAAAAAvABzaAABFDm3GgAAAABJRU5ErkJggg==');
            --theme-bg-blend: multiply;
            --theme-header-bg: #8E3535;
            --theme-header-texture: none; 
            --theme-text-main: #1a1a1a;
            --theme-text-sub: #666;
            --theme-accent: #8E3535;
            --theme-border: #ccc;
            --theme-shadow: rgba(0,0,0,0.6);
            --theme-barcode-opacity: 0.6;
            --modal-tip-color: #8E3535; 
        }

        /* --- å¯¼æ¼”ä¸»é¢˜ (é»‘é‡‘) --- */
        [data-theme="director"] {
            --theme-bg-color: #1a1a1a;
            --theme-bg-texture: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyAQMAAAAk8RryAAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlP/AOW3MEoAAAARElEQVQY02NggAJfMJRcQAAA4YAhAW6CCwAAAABJRU5ErkJggg==');
            --theme-header-bg: #000; 
            --theme-header-texture: repeating-linear-gradient(135deg, #b88a00, #b88a00 2px, #d4af37 2px, #d4af37 4px);
            --theme-text-main: #d4af37;
            --theme-text-sub: #967c3a;
            --theme-accent: #d4af37;
            --theme-border: #5c4d26;
            --theme-shadow: rgba(212, 175, 55, 0.3);
            --theme-barcode-opacity: 0.8;
        }
        body.director-active { background-color: #000; --modal-tip-color: #d4af37; }

        /* --- ã€ç¨³å®šç‰ˆã€‘æ‹äººä¸»é¢˜ (å¤å¤æ·±ç²‰ + å®‰å…¨çº¸çº¹) --- */
        [data-theme="lover"] {
            /* 1. ä½¿ç”¨ä½ å–œæ¬¢çš„å¤å¤èƒ­è„‚ç²‰åº•è‰² */
            --theme-bg-color: #f2dcdc; 
            
            /* 2. ã€å…³é”®ä¿®æ”¹ã€‘ç§»é™¤SVGï¼Œæ”¹ç”¨å’Œé»˜è®¤ä¸»é¢˜ä¸€æ ·çš„PNGçº¸çº¹ */
            /* è¿™æ ·æ—¢ä¿ç•™äº†å¤å¤è´¨æ„Ÿï¼Œåˆç»å¯¹ä¸ä¼šæŠ¥é”™ */
            --theme-bg-texture: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAD2Cz0MAAAADFBMVEUAAAD////8/Pz///+///+/AAAAAnRSTlP/AOW3MEoAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnSURBVEiJ7dExAQAAAMKg9U9tCy+gAAAAAAAAAAAAAAAAAAAAvABzaAABFDm3GgAAAABJRU5ErkJggg==');
            --theme-bg-blend: multiply; 

            --theme-header-bg: #a65f73;
            --theme-header-texture: none;

            --theme-text-main: #6d2e3d; 
            --theme-text-sub: #a67b85;  
            --theme-accent: #6d2e3d;    
            --theme-border: #c48b9f;    
            
            --theme-shadow: rgba(166, 95, 115, 0.5); 
            --theme-barcode-opacity: 0.7;
        }
        body.lover-active { background-color: #2a1b1e; --modal-tip-color: #c48b9f; }

        /* =========================================
           åŸºç¡€æ ·å¼
        ========================================= */
        body {
            background-color: #0a0a0a;
            color: #eee;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: background-color 0.5s ease;
        }
        
        h2, button, .controls p { font-family: 'Cinzel', serif; }
        h2 { margin-bottom: 10px; font-weight: 400; letter-spacing: 2px; }

        .controls {
            margin-bottom: 40px;
            text-align: center;
            width: 100%;
            max-width: 400px;
        }

        input {
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #333;
            background-color: #222;
            color: #8E3535;
            width: 70%;
            margin-bottom: 15px;
            font-size: 16px;
            text-align: center;
            font-family: 'Noto Serif TC', serif;
            outline: none;
            transition: all 0.3s;
        }
        input:focus { border-color: #8E3535; box-shadow: 0 0 10px rgba(142, 53, 53, 0.4); }
        
        body.director-active input { color: #d4af37; }
        body.director-active input:focus { border-color: #d4af37; box-shadow: 0 0 10px rgba(212, 175, 55, 0.4); }
        body.lover-active input { color: #c48b9f; }
        body.lover-active input:focus { border-color: #c48b9f; box-shadow: 0 0 10px rgba(196, 139, 159, 0.4); }

        button {
            padding: 10px 30px;
            background: linear-gradient(45deg, #8E3535, #a64444);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 14px;
            cursor: pointer;
            letter-spacing: 1px;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(142, 53, 53, 0.4);
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(142, 53, 53, 0.6); }
        
        body.director-active button { background: linear-gradient(45deg, #d4af37, #f2d06b); color: #000; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4); }
        body.lover-active button { background: linear-gradient(45deg, #c48b9f, #dcaab6); color: #fff; box-shadow: 0 4px 15px rgba(196, 139, 159, 0.4); }

        /* =========================================
           ç¥¨æ ¹æ ·å¼
        ========================================= */
        #ticket-container {
            width: 320px; 
            background-color: var(--theme-bg-color);
            background-repeat: repeat; /* ç¡®ä¿çº¹ç†é‡å¤ */
            background-image: var(--theme-bg-texture);
            background-blend-mode: var(--theme-bg-blend);
            color: var(--theme-text-main);
            border-radius: 8px;
            box-shadow: 0 20px 40px var(--theme-shadow);
            overflow: hidden;
            position: relative;
            transition: all 0.6s;
        }

        .ticket-header {
            background-color: var(--theme-header-bg);
            background-image: var(--theme-header-texture);
            height: 20px; 
            width: 100%;
            transition: all 0.6s;
        }

        .ticket-body {
            padding: 30px 25px 15px 25px;
            text-align: center;
            border-bottom: 2px dashed var(--theme-border);
            position: relative;
            transition: border-color 0.6s;
        }
        .ticket-body::before, .ticket-body::after {
            content: ''; position: absolute; bottom: -10px; width: 20px; height: 20px;
            background-color: #0a0a0a; border-radius: 50%; transition: background-color 0.5s ease;
        }
        .ticket-body::before { left: -10px; }
        .ticket-body::after { right: -10px; }
        body.director-active .ticket-body::before, body.director-active .ticket-body::after { background-color: #000; }
        body.lover-active .ticket-body::before, body.lover-active .ticket-body::after { background-color: #2a1b1e; }

        .film-title { font-family: 'Noto Serif TC', serif; font-size: 28px; font-weight: 700; margin: 5px 0 10px 0; letter-spacing: 3px; color: var(--theme-text-main); transition: color 0.6s; }
        .film-subtitle { font-family: 'Cinzel', serif; font-size: 14px; color: var(--theme-text-sub); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 5px; font-weight: 700; transition: color 0.6s; }
        .starring { font-family: 'Cinzel', serif; font-size: 10px; color: var(--theme-text-sub); margin-bottom: 15px; letter-spacing: 1px; transition: color 0.6s; }
        .project-note { font-family: 'Noto Serif TC', serif; font-size: 10px; color: var(--theme-accent); letter-spacing: 1px; margin-top: 15px; opacity: 0.8; transition: color 0.6s; }

        .secret-message {
            height: 0; overflow: hidden; opacity: 0; font-size: 11px; color: var(--theme-accent);
            font-family: 'Noto Serif TC', serif; margin-top: 0; letter-spacing: 2px; font-weight: bold;
            transition: all 0.6s; border-top: 1px solid transparent;
        }
        [data-theme="director"] .secret-message, [data-theme="lover"] .secret-message {
            height: auto; opacity: 1; margin-top: 10px; padding-top: 10px; border-color: var(--theme-border);
        }

        .info-grid { display: flex; justify-content: space-between; font-family: 'Cinzel', serif; font-size: 10px; color: var(--theme-text-sub); margin-top: 20px; text-align: left; transition: color 0.6s; }
        .info-item span { display: block; font-weight: 700; color: var(--theme-text-main); font-size: 14px; margin-top: 2px; font-family: 'Helvetica Neue', sans-serif; transition: color 0.6s; }

        .ticket-stub { padding: 15px 25px; background-color: var(--theme-bg-color); background-image: var(--theme-bg-texture); background-blend-mode: var(--theme-bg-blend); display: flex; justify-content: space-between; align-items: center; transition: all 0.6s; }
        .guest-name { font-family: "Courier New", Courier, monospace; font-size: 16px; font-weight: bold; color: var(--theme-accent); text-transform: uppercase; max-width: 180px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; transition: color 0.6s; }
        .admit-one { font-family: 'Cinzel', serif; font-size: 9px; color: var(--theme-text-sub); letter-spacing: 1px; border: 1px solid var(--theme-text-sub); padding: 3px 6px; transition: all 0.6s; }
        [data-theme="director"] .admit-one, [data-theme="lover"] .admit-one { color: var(--theme-accent); border-color: var(--theme-accent); font-weight: bold; }
        
        .barcode { height: 25px; width: 100%; background: linear-gradient(to right, currentColor 0%, currentColor 3%, transparent 3%, transparent 5%, currentColor 5%, currentColor 8%, transparent 8%, transparent 10%, currentColor 10%, currentColor 15%, transparent 15%, transparent 18%, currentColor 18%, currentColor 25%, transparent 25%, transparent 30%, currentColor 30%, currentColor 45%, transparent 45%, transparent 50%, currentColor 50%, currentColor 55%, transparent 55%, transparent 60%, currentColor 60%, currentColor 70%, transparent 70%, transparent 80%, currentColor 80%, currentColor 100%); margin-top: 15px; opacity: var(--theme-barcode-opacity); color: var(--theme-text-sub); transition: color 0.6s, opacity 0.6s; }
        .footer-note { margin-top: 20px; font-size: 12px; color: #666; font-family: 'Cinzel', serif; }
        .closing-statement { text-align: center; margin: 50px 20px; color: #888; font-family: 'Noto Serif TC', serif; font-size: 12px; line-height: 2; opacity: 0.8; }

        /* =========================================
           é•¿æŒ‰ä¿å­˜å¼¹çª—æ ·å¼
        ========================================= */
        #result-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: none; /* é»˜è®¤éšè— */
            flex-direction: column; align-items: center; justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        #result-img {
            max-width: 85%; max-height: 75vh;
            border-radius: 8px;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
            pointer-events: auto; 
            -webkit-user-select: none;
        }
        .modal-tip {
            color: var(--modal-tip-color); /* è·Ÿéšä¸»é¢˜å˜è‰² */
            font-family: 'Noto Serif TC', serif; margin-top: 25px; font-size: 15px; letter-spacing: 2px; font-weight: bold;
            animation: pulse 2s infinite;
            transition: color 0.5s ease;
        }
        .modal-close {
            position: absolute; top: 30px; right: 30px;
            color: rgba(255,255,255,0.6); font-size: 30px; cursor: pointer;
            font-family: Arial, sans-serif; padding: 10px;
        }
        @keyframes pulse { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }

    </style>
</head>
<body id="main-body">

    <div class="controls">
        <h2>ARS AMATORIA</h2>
        <p style="font-size: 12px; color: #999; margin-bottom: 15px;">Please enter your name to retrieve ticket</p>
        <input type="text" id="nameInput" placeholder="..." maxlength="25">
        <br>
        <button onclick="generateAndShow()" id="dl-btn">GET TICKET</button>
    </div>

    <div id="ticket-container" data-theme="default">
        <div class="ticket-header"></div>
        <div class="ticket-body">
            <div class="film-subtitle">Ars Amatoria</div>
            <div class="film-title">ã€Šæ„›çš„è—è¡“ã€‹</div>
            <div class="starring">STARRING: NoFear Ã— QingRong</div>
            <div class="barcode"></div>
            <div class="info-grid">
                <div class="info-item">DATE<span id="ticket-date">DEC 24</span></div>
                <div class="info-item">TIME<span id="ticket-time">18:00</span></div>
                <div class="info-item">SEAT<span id="seat-type">VIP</span></div>
            </div>
            <div class="project-note">æ¡ƒçµ¨2025è–èª•ä¼åŠƒ</div>
            <div class="secret-message" id="secret-msg-text">â€” æ„Ÿè¬æ‚¨æ§‹å»ºäº†é€™å€‹ä¸–ç•Œ â€”</div>
        </div>
        <div class="ticket-stub">
            <div>
                <div style="font-size: 9px; color: var(--theme-text-sub); font-family:'Cinzel',serif; transition: color 0.6s;" id="role-label">GUEST</div>
                <div class="guest-name" id="display-name">AUDIENCE</div>
            </div>
            <div class="admit-one">ADMIT ONE</div>
        </div>
    </div>

    <div class="closing-statement">
        <p>â€”â€” å¸·å¹•è½ä¸‹ â€”â€”</p>
        <p>æ„Ÿè¬è’è‡¨ã€Šæ„›çš„è—è¡“ã€‹æ¡ƒçµ¨å½±å±•ã€‚</p>
        <p>è«‹æ”¶å¥½æ‚¨çš„å…¥å ´åˆ¸ï¼Œå®ƒæ˜¯é€šå¾€æœ¬æ¬¡è–èª•å›æ†¶çš„å”¯ä¸€æ†‘è­‰ã€‚</p>
        <p style="margin-top: 20px; font-family: 'Cinzel', serif; letter-spacing: 2px;">FIN.</p>
    </div>
    <div class="footer-note">Created for NoFear Ã— QingRong</div>

    <div id="result-modal" onclick="closeModal()">
        <img id="result-img" src="" alt="Ticket" onclick="event.stopPropagation()">
        <div class="modal-tip">è«‹é•·æŒ‰åœ–ç‰‡ä¿å­˜è‡³ç›¸å†Š</div>
        <div class="modal-close">Ã—</div>
    </div>

    <script>
        const directorsSchedule = {
            "1cho": { date: "DEC 24", time: "18:00" },
            "å¦‚æœè¦è®©æˆ‘æ¥è®²è¿™ä¸ªæ•…äº‹": { date: "DEC 24", time: "20:00" },
            "ç¥š": { date: "DEC 24", time: "22:00" },
            "é€™å£¹ç‰‡çç æµ·": { date: "DEC 24", time: "24:00" },
            "é›ªæ¢¨": { date: "DEC 25", time: "08:00" },
            "palpitate_51": { date: "DEC 25", time: "10:00" },
            "debrisoo": { date: "DEC 25", time: "12:00" },
            "è”“è¶Šè“è„†æ›²å¥‡": { date: "DEC 25", time: "14:00" },
            "è¿‡ä¸–è·¯ç²‰": { date: "DEC 25", time: "16:00" },
            "aristolight": { date: "DEC 25", time: "18:00" }
        };
        // ğŸ’– è®°å¾—åœ¨è¿™é‡Œå¡«å…¥ä½ çš„å½©è›‹ ID ğŸ’–
        const loversList = ["yyyyq",
            "denny",
            "nofear",
            "qingrong",
            "rong",
            "è¯ºè²å°”", 
            "è",                             
            "apricat",
            "æ— ç•",
            "ç„¡ç•",
            "æ¸…è",
            "æ¨æ¶›",
            "æ¥Šæ¿¤",
            "é»ƒåšæ¬½",
            "é»„åšé’¦",]

        const nameInput = document.getElementById('nameInput');
        const displayName = document.getElementById('display-name');
        const ticketContainer = document.getElementById('ticket-container');
        const roleLabel = document.getElementById('role-label');
        const seatType = document.getElementById('seat-type');
        const mainBody = document.getElementById('main-body');
        const dateEl = document.getElementById('ticket-date');
        const timeEl = document.getElementById('ticket-time');
        const secretMsgText = document.getElementById('secret-msg-text');
        
        const modal = document.getElementById('result-modal');
        const resultImg = document.getElementById('result-img');

        nameInput.addEventListener('input', function() {
            const inputVal = this.value.trim();
            const inputKey = inputVal.toLowerCase();
            
            if (inputVal === "") { displayName.innerText = "AUDIENCE"; } 
            else { displayName.innerText = inputVal; }

            if (directorsSchedule[inputKey]) {
                setTheme('director');
                roleLabel.innerText = "DIRECTOR"; seatType.innerText = "CREW";
                secretMsgText.innerText = "â€” æ„Ÿè¬æ‚¨æ§‹å»ºäº†é€™å€‹ä¸–ç•Œ â€”";
                dateEl.innerText = directorsSchedule[inputKey].date;
                timeEl.innerText = directorsSchedule[inputKey].time;
            } else if (loversList.includes(inputKey)) {
                setTheme('lover');
                roleLabel.innerText = "LOVER"; seatType.innerText = "VVIP";
                secretMsgText.innerText = "â€” æ„›æ˜¯æ°¸ä¸è½å¹•çš„é›»å½± â€”";
                dateEl.innerText = "DEC 24"; timeEl.innerText = "FOREVER";
            } else {
                setTheme('default');
                roleLabel.innerText = "GUEST"; seatType.innerText = "VIP";
                dateEl.innerText = "DEC 24"; timeEl.innerText = "18:00";
            }
        });

        function setTheme(theme) {
            ticketContainer.setAttribute('data-theme', theme);
            mainBody.classList.remove('director-active', 'lover-active');
            if (theme === 'director') { mainBody.classList.add('director-active'); } 
            else if (theme === 'lover') { mainBody.classList.add('lover-active'); }
        }

        function generateAndShow() {
            const btn = document.getElementById('dl-btn');
            const originalText = btn.innerText;
            btn.innerText = "GENERATING...";
            btn.disabled = true;

            const ticket = document.getElementById("ticket-container");
            const originalShadow = ticket.style.boxShadow;
            ticket.style.boxShadow = 'none';

            setTimeout(() => {
                html2canvas(ticket, {
                    scale: 3, 
                    backgroundColor: null, 
                    useCORS: true,
                    allowTaint: true 
                }).then(canvas => {
                    ticket.style.boxShadow = originalShadow;
                    btn.innerText = originalText;
                    btn.disabled = false;
                    
                    const imgData = canvas.toDataURL("image/png");
                    resultImg.src = imgData;
                    modal.style.display = 'flex';
                    
                }).catch(err => {
                    alert("ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç›´æ¥æˆªåœ–ã€‚");
                    ticket.style.boxShadow = originalShadow;
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
            }, 100);
        }

        function closeModal() {
            modal.style.display = 'none';
            setTimeout(() => { resultImg.src = ""; }, 200);
        }
    </script>
</body>
</html>
